<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CV ‚Äî –º–∞–∫–µ—Ç A4, 2 –∫–æ–ª–æ–Ω–∫–∏</title>
    <meta name="color-scheme" content="light dark">
    <style>
        :root{
            --paper:#fff;
            --ink:#111;
            --muted:#6b7280;
            --rule:#e5e7eb;
            --chip:#f3f4f6;
            --gap-mm:0mm;
            --left-mm:72mm;
            --pad-mm:0mm;
        }
        @media (prefers-color-scheme: dark){
            body{ background:#0b0d10; }
        }
        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            background:#f1f5f9;
            color:var(--ink);
            font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
        }

        /* ===== –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ===== */
        .pages{
            width:210mm;
            margin:18mm auto;
        }

        /* ===== –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî –†–û–í–ù–û A4 –ø–æ –≤—ã—Å–æ—Ç–µ ===== */
        .listA4{
            width:210mm;
            height:297mm;                 /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –ø–æ–¥ A4 */
            background:var(--paper);
            box-shadow:0 10px 30px rgba(0,0,0,.08);
            border-radius:4px;
            overflow:hidden;              /* –≤–∞–∂–Ω–æ: —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–∫—Ä–æ–ª–ª–∞ –≤–Ω—É—Ç—Ä–∏ */
            display:grid;
            padding:var(--pad-mm);
            grid-template-columns: var(--left-mm) 1fr;
            grid-template-rows: 1fr;
            column-gap: var(--gap-mm);
            margin-bottom:12mm;           /* –∑–∞–∑–æ—Ä –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ */
        }

        /* ===== –ö–æ–ª–æ–Ω–∫–∏ ===== */
        .colum-left{
            display:flex;
            flex-direction:column;
            gap: calc(var(--gap-mm) * .6);
            min-width:0;
            background:#f3f3f3;
            border-right: 1px solid #ff1010;
            -webkit-print-color-adjust: exact;
            padding-bottom:1px; /* –º–∏–∫—Ä–æ-—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä –∏–∑–º–µ—Ä–µ–Ω–∏–π */
        }
        .colum-right{
            display:flex;
            flex-direction:column;
            gap: calc(var(--gap-mm) * .6);
            min-width:0;
            padding-bottom:1px;
        }

        /* –ë–ª–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–æ–∫ */
        .colum-left > .blk{
            background: transparent;
            border: none;
            padding: 0;
            border-radius: 0;
            break-inside: avoid;
            page-break-inside: avoid;
        }
        .colum-right > .blk{
            border-radius: 8px;
            background: color-mix(in oklab, var(--paper) 96%, transparent);
            border: 1px solid var(--rule);
            padding: 10px 12px;
            break-inside: avoid;
            page-break-inside: avoid;
        }

        /* –§–æ—Ç–æ */
        .block-photo {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60mm;
            height: 60mm;
            margin: 0 auto;
            border-radius: 50%;
            overflow: hidden;
            background: #e0e0e0;
            box-shadow: none;
        }
        .block-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            display: block;
        }

        .block-contacts ul,
        .block-skills ul,
        .block-tools ul{
            margin:.4rem 0 0; padding-left:1.1rem;
        }
        .block-contacts,
        .block-skills,
        .block-tools {
            margin-left: 10mm;
        }

        .pill set{ list-style:none; padding:0; margin:.2rem 0 0; display:flex; flex-wrap:wrap; gap:6px; }
        .pill set li{
            background:var(--chip);
            border:1px solid var(--rule);
            border-radius:999px;
            padding:5px 8px;
            font-size:12px;
        }

        .block-name{ border:none; padding:0; }
        .block-name h1{ margin:0; font-size:28px; line-height:1.2; }
        .block-position{ border:none; padding:0; color:var(--muted); margin-top:2px; }
        .block-about-me p{ margin:.4rem 0 0; }
        .block-experience .job{ margin:.5rem 0 0; padding:.2rem 0 0; border-top:1px solid var(--rule); }
        .block-experience .job h3{ margin:.2rem 0; font-size:15px; }
        .meta{ color:var(--muted); font-size:12px; }

        /* –ü–µ—á–∞—Ç—å */
        @page{ size:A4; margin: 12mm; }
        @media print{
            html,body{ background:transparent; }
            .pages{ width:auto; margin:0; }
            .listA4{
                margin:0 0 0 0;
                box-shadow:none; border-radius:0;
            }
            a[href^="http"]::after{ content:" (" attr(href) ")"; color:#777; font-size:10px; }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ (–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ) */
        @media (max-width: 960px){
            .pages{ width:100%; margin:0; }
            .listA4{ width:100%; border-radius:0; box-shadow:none; }
        }
    </style>
</head>
<body>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü -->
<div class="pages" id="pages"></div>

<!-- –®–∞–±–ª–æ–Ω –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é) -->
<template id="page-template">
    <div class="listA4">
        <div class="colum-left"></div>
        <div class="colum-right"></div>
    </div>
</template>

<script>
    async function loadCV(){
        try{
            const res = await fetch('data.json', {cache:'no-store'});
            const data = await res.json();
            paginateFromData(data);
        }catch(e){
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å data.json', e);
        }
    }

    /* –£—Ç–∏–ª–∏—Ç–∞: —Å–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç */
    function el(tag, attrs={}, children=[]){
        const node = document.createElement(tag);
        Object.entries(attrs).forEach(([k,v])=>{
            if(k==='text') node.textContent = v;
            else if(k==='html') node.innerHTML = v;
            else if(k==='class') node.className = v;
            else node.setAttribute(k,v);
        });
        children.forEach(ch => node.appendChild(ch));
        return node;
    }

    /* mm -> px (—Ç–æ—á–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—É—é –º–µ—Ç—Ä–∏–∫—É) */
    function mmToPx(mm){
        const d = document.createElement('div');
        d.style.position = 'absolute';
        d.style.visibility = 'hidden';
        d.style.height = '1mm';
        document.body.appendChild(d);
        const one = d.getBoundingClientRect().height || 3.78; // fallback ~96dpi
        d.remove();
        return mm * one;
    }

    /* –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–∑ —à–∞–±–ª–æ–Ω–∞ */
    function newPage(){
        const tmpl = document.getElementById('page-template');
        return tmpl.content.firstElementChild.cloneNode(true);
    }

    /* –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–ª–µ–∑–∞–µ—Ç –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
    function pageFits(page){
        // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –∏ –≤–∏–¥–∏–º—É—é –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        return page.scrollHeight <= page.clientHeight + 0.5; // –Ω–µ–±–æ–ª—å—à–æ–π –ª—é—Ñ—Ç
    }

    /* –ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–∫–æ–ª–æ–Ω–∫—É).
       –ï—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî –±–ª–æ–∫ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.
       –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é (–≤–æ–∑–º–æ–∂–Ω–æ –Ω–æ–≤—É—é) —Å—Ç—Ä–∞–Ω–∏—Ü—É. */
    function appendWithPagination(pagesWrap, page, columnEl, block){
        columnEl.appendChild(block);
        if (!pageFits(page)){
            columnEl.removeChild(block);
            // –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const next = newPage();
            pagesWrap.appendChild(next);
            const left = next.querySelector('.colum-left');
            const right = next.querySelector('.colum-right');
            // –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω—É–∂–Ω—É—é –∫–æ–ª–æ–Ω–∫—É –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (columnEl.classList.contains('colum-left')) left.appendChild(block);
            else right.appendChild(block);
            return next;
        }
        return page;
    }

    /* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ */
    function buildLeftBlocks(cv){
        const out = [];

        // –§–æ—Ç–æ
        if (cv.personal?.photo){
            const ph = el('div', {class:'blk block-photo'},
                [ el('img', {src: cv.personal.photo, alt:'–§–æ—Ç–æ'}) ]);
            out.push(ph);
        }

        // –ö–æ–Ω—Ç–∞–∫—Ç—ã
        const contacts = el('div', {class:'blk block-contacts'}, [
            el('h2', {text:'–ö–æ–Ω—Ç–∞–∫—Ç—ã'}),
            el('ul', {}, [])
        ]);
        const cul = contacts.querySelector('ul');
        if (cv.contacts?.email) cul.appendChild(el('li', {html:`üìß <a href="mailto:${cv.contacts.email}">${cv.contacts.email}</a>`}));
        if (cv.contacts?.phone){
            const telDigits = cv.contacts.phone.replace(/\s|-/g,'');
            cul.appendChild(el('li', {html:`üì± <a href="tel:${telDigits}">${cv.contacts.phone}</a>`}));
        }
        if (cv.contacts?.location) cul.appendChild(el('li', {text:`üìç ${cv.contacts.location}`}));
        if (cv.contacts?.telegram){
            const txt = cv.contacts.telegram.replace(/^https?:\/\//,'');
            cul.appendChild(el('li', {html:`üí¨ <a href="${cv.contacts.telegram}" target="_blank">${txt}</a>`}));
        }
        out.push(contacts);

        // –ù–∞–≤—ã–∫–∏
        if (Array.isArray(cv.skills) && cv.skills.length){
            const s = el('div', {class:'blk block-skills'}, [
                el('h2', {text:'–ù–∞–≤—ã–∫–∏'}),
                el('ul', {class:'pillset'}, cv.skills.map(x=>el('li',{text:x})))
            ]);
            out.push(s);
        }

        // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        if (Array.isArray(cv.tools) && cv.tools.length){
            const t = el('div', {class:'blk block-tools'}, [
                el('h2', {text:'–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã'}),
                el('ul', {class:'pillset'}, cv.tools.map(x=>el('li',{text:x})))
            ]);
            out.push(t);
        }

        return out;
    }

    function buildRightBlocks(cv){
        const seq = [];

        // –ò–º—è/–ø–æ–∑–∏—Ü–∏—è –µ–¥–∏–Ω—ã–º –±–ª–æ–∫–æ–º (–∫–æ–º–ø–∞–∫—Ç–Ω–æ, –ª—É—á—à–µ –¥–µ—Ä–∂–∞—Ç—å –≤–º–µ—Å—Ç–µ)
        const head = el('div', {class:'blk'}, [
            el('div', {class:'block-name'}, [ el('h1', {text: cv.personal?.name || ''}) ]),
            el('div', {class:'block-position', text: cv.personal?.position || ''})
        ]);
        seq.push(head);

        // –û–±–æ –º–Ω–µ
        if (cv.personal?.about){
            const about = el('div', {class:'blk block-about-me'}, [
                el('h2', {text:'–û–±–æ –º–Ω–µ'}),
                el('p', {text: cv.personal.about})
            ]);
            seq.push(about);
        }

        // –û–ø—ã—Ç ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫, –∑–∞—Ç–µ–º –∫–∞–∂–¥–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º –±–ª–æ–∫–æ–º
        const expHeader = () => el('div', {class:'blk'}, [ el('h2', {text:'–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã'}) ]);
        let addedAnyExp = false;
        if (Array.isArray(cv.experience) && cv.experience.length){
            seq.push(expHeader()); // –ø–µ—Ä–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
            addedAnyExp = true;
            cv.experience.forEach(job=>{
                const jobDiv = el('div', {class:'blk block-experience'}, [
                    el('div', {class:'job'}, [
                        el('h3', {text:`${job.company} ‚Äî ${job.position}`}),
                        el('div', {class:'meta', text:`${job.period}${job.location ? ', ' + job.location : ''}`}),
                        (Array.isArray(job.responsibilities) && job.responsibilities.length)
                            ? el('ul', {}, job.responsibilities.map(r=>el('li',{text:r})))
                            : el('div') /* –ø—É—Å—Ç—ã—à–∫–∞ */
                    ])
                ]);
                // —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞ –¥–ª—è –ª–æ–≥–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                jobDiv.dataset.section = 'experience';
                seq.push(jobDiv);
            });
        }

        // –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
        const eduHeader = () => el('div', {class:'blk'}, [ el('h2', {text:'–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ'}) ]);
        if (Array.isArray(cv.education) && cv.education.length){
            seq.push(eduHeader());
            cv.education.forEach(ed=>{
                const edBlk = el('div', {class:'blk block-education'}, [
                    el('p', {}, [
                        el('strong', {text: ed.institution || ''}),
                        el('br'),
                        el('span', {class:'meta', text:`${ed.period || ''} ¬∑ ${ed.program || ''}`})
                    ])
                ]);
                edBlk.dataset.section = 'education';
                seq.push(edBlk);
            });
        }

        return { seq, headers: { experience: expHeader, education: eduHeader } };
    }

    /* –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
    function paginateFromData(cv){
        const pagesWrap = document.getElementById('pages');
        pagesWrap.innerHTML='';

        // —Å–æ–∑–¥–∞—ë–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        let page = newPage();
        pagesWrap.appendChild(page);
        let left = page.querySelector('.colum-left');
        let right = page.querySelector('.colum-right');

        // –ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–µ–∫—Ü–∏—è–º–∏ –±–ª–æ–∫–∞–º–∏
        const leftBlocks = buildLeftBlocks(cv);
        leftBlocks.forEach(block=>{
            const before = page;
            page = appendWithPagination(pagesWrap, page, left, block);
            if (page !== before){ // –µ—Å–ª–∏ –ø–µ—Ä–µ–µ—Ö–∞–ª–∏ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º —Å—Å—ã–ª–∫–∏
                left = page.querySelector('.colum-left');
                right = page.querySelector('.colum-right');
            }
        });

        // –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ–ª–∫–∏—Ö –±–ª–æ–∫–æ–≤, —Å –ø–æ–≤—Ç–æ—Ä–∞–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ
        const { seq, headers } = buildRightBlocks(cv);
        let lastSection = null; // 'experience' | 'education' | null
        seq.forEach(block=>{
            const before = page;
            page = appendWithPagination(pagesWrap, page, right, block);

            // –µ—Å–ª–∏ –±–ª–æ–∫ –Ω–µ –ø–æ–º–µ—Å—Ç–∏–ª—Å—è –∏ –ø–µ—Ä–µ–ª–∏—Å—Ç–Ω—É–ª–∏ ‚Äî –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏ –ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
            if (page !== before){
                left = page.querySelector('.colum-left');
                right = page.querySelector('.colum-right');

                // –µ—Å–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –±–ª–æ–∫ —Å–µ–∫—Ü–∏–∏ (experience/education), –¥–æ–±–∞–≤–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                const section = block.dataset.section;
                if (section && headers[section]){
                    const hdr = headers[section]();
                    // –í–°–¢–ê–í–õ–Ø–ï–ú –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–µ–¥ —Å–∞–º–∏–º –±–ª–æ–∫–æ–º –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    right.insertBefore(hdr, block);
                    // –µ—Å–ª–∏ –≤–Ω–µ–∑–∞–ø–Ω–æ –¥–∞–∂–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –≤–ª–µ–∑ (–∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–∏–π —Å–ª—É—á–∞–π) ‚Äî –Ω–∞—á–Ω—ë–º –µ—â—ë –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    if (!pageFits(page)){
                        right.removeChild(hdr);
                        right.removeChild(block);
                        const next = newPage();
                        pagesWrap.appendChild(next);
                        page = next;
                        left = page.querySelector('.colum-left');
                        right = page.querySelector('.colum-right');
                        right.appendChild(hdr);
                        right.appendChild(block);
                    }
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', loadCV);
</script>
</body>
</html>
