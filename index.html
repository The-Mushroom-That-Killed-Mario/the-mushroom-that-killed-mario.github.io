<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CV ‚Äî –º–∞–∫–µ—Ç A4, 2 –∫–æ–ª–æ–Ω–∫–∏</title>
    <meta name="color-scheme" content="light dark">
    <style>
        :root{
            --paper:#fff;
            --ink:#111;
            --muted:#6b7280;
            --rule:#e5e7eb;
            --chip:#f3f4f6;
            --gap-mm:0mm;
            --left-mm:72mm;
            --pad-mm:0mm;
        }
        @media (prefers-color-scheme: dark){
            body{ background:#0b0d10; }
        }
        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            background:#f1f5f9;
            color:var(--ink);
            font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
        }

        /* ===== Desktop / Print –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü ===== */
        .pages{
            width:210mm;
            margin:18mm auto;
        }
        .listA4{
            width:210mm;
            height:297mm;                 /* —Ä–æ–≤–Ω–æ A4 */
            background:var(--paper);
            box-shadow:0 10px 30px rgba(0,0,0,.08);
            border-radius:4px;
            overflow:hidden;
            display:grid;
            padding:var(--pad-mm);
            grid-template-columns: var(--left-mm) 1fr;
            grid-template-rows: 1fr;
            column-gap: var(--gap-mm);
            margin-bottom:12mm;           /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ */
        }
        .colum-left{
            display:flex; flex-direction:column; gap: calc(var(--gap-mm) * .6); min-width:0;
            background:#f3f3f3; border-right:1px solid #ff1010; -webkit-print-color-adjust: exact;
            padding-bottom:1px;
        }
        .colum-right{
            display:flex; flex-direction:column; gap: calc(var(--gap-mm) * .6); min-width:0;
            padding-bottom:1px;
        }

        .colum-left > .blk{
            background: transparent; border:none; padding:0; border-radius:0;
            break-inside: avoid; page-break-inside: avoid;
        }
        .colum-right > .blk{
            border-radius: 8px;
            background: color-mix(in oklab, var(--paper) 96%, transparent);
            border: 1px solid var(--rule);
            padding: 10px 12px;
            break-inside: avoid; page-break-inside: avoid;
        }

        /* –§–æ—Ç–æ */
        .block-photo {
            display:flex; justify-content:center; align-items:center;
            width:60mm; height:60mm; margin:0 auto; border-radius:50%; overflow:hidden;
            background:#e0e0e0; box-shadow:none;
        }
        .block-photo img { width:100%; height:100%; object-fit:cover; border-radius:50%;
            box-shadow:0 2px 6px rgba(0,0,0,.15); display:block; }

        .block-contacts ul, .block-skills ul, .block-tools ul{ margin:.4rem 0 0; padding-left:1.1rem; }
        .block-contacts, .block-skills, .block-tools { margin-left:10mm; }

        .pill set{ list-style:none; padding:0; margin:.2rem 0 0; display:flex; flex-wrap:wrap; gap:6px; }
        .pill set li{ background:var(--chip); border:1px solid var(--rule); border-radius:999px; padding:5px 8px; font-size:12px; }

        .block-name{ border:none; padding:0; }
        .block-name h1{ margin:0; font-size:28px; line-height:1.2; }
        .block-position{ border:none; padding:0; color:var(--muted); margin-top:2px; }
        .block-about-me p{ margin:.4rem 0 0; }
        .block-experience .job{ margin:.5rem 0 0; padding:.2rem 0 0; border-top:1px solid var(--rule); }
        .block-experience .job h3{ margin:.2rem 0; font-size:15px; }
        .meta{ color:var(--muted); font-size:12px; }

        /* ===== –ú–æ–±–∏–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞ (–±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏) ===== */
        #mobile{ display:none; }
        #mobile .blk{
            background:var(--paper);
            border:1px solid var(--rule);
            border-radius:8px;
            padding:12px;
            margin:10px 12px;
        }
        #mobile .block-photo{
            width:160px; height:160px; margin:8px auto 4px auto;
        }
        #mobile .block-contacts, #mobile .block-skills, #mobile .block-tools{
            margin-left:0;
        }

        /* ===== –ü–µ—á–∞—Ç—å ===== */
        @page{ size:A4; margin: 12mm; }
        @media print{
            html,body{ background:transparent; }
            .pages{ display:block !important; width:auto; margin:0 !important; }
            #mobile{ display:none !important; }

            .listA4{
                margin:0 !important;
                box-shadow:none; border-radius:0;
                height:297mm;                /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ª–∏—Å—Ç–∞ */
                overflow:hidden;
                page-break-after: always;
            }
            .listA4:last-child{ page-break-after: auto; }

            /* –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å URL —Ä—è–¥–æ–º —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */
            a[href^="http"]::after{ content:" (" attr(href) ")"; color:#777; font-size:10px; }
        }

        /* ===== –ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (—ç–∫—Ä–∞–Ω) ===== */
        @media (max-width: 960px){
            .pages{ display:none; }      /* —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            #mobile{ display:block; }    /* –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–µ–Ω—Ç—É */
            body{ background:#fff; }     /* —á–∏—Å—Ç—ã–π —Ñ–æ–Ω */
        }
    </style>
</head>
<body>

<!-- Desktop / Print: —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ A4 -->
<div class="pages" id="pages"></div>

<!-- Mobile: –æ–¥–∏–Ω –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –±–ª–æ–∫–æ–≤ -->
<div id="mobile"></div>

<!-- –®–∞–±–ª–æ–Ω –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<template id="page-template">
    <div class="listA4">
        <div class="colum-left"></div>
        <div class="colum-right"></div>
    </div>
</template>

<script>
    let __CV_DATA = null;    // –∫—ç—à –¥–∞–Ω–Ω—ã—Ö
    let __IS_MOBILE = null;  // —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ matchMedia

    document.addEventListener('DOMContentLoaded', loadCV);

    /* === –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–±–æ—Ä —Ä–µ–Ω–¥–µ—Ä–∞ === */
    async function loadCV(){
        try{
            const res = await fetch('data.json', {cache:'no-store'});
            const data = await res.json();
            __CV_DATA = data;

            const mq = window.matchMedia('(max-width: 960px)');
            __IS_MOBILE = mq.matches;

            if (__IS_MOBILE) renderMobile(data);
            else             paginateFromData(data);

            // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∏—Ä–∏–Ω—ã
            mq.addEventListener('change', (e)=>{
                __IS_MOBILE = e.matches;
                clearAll();
                __IS_MOBILE ? renderMobile(__CV_DATA) : paginateFromData(__CV_DATA);
            });

            // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø–µ—á–∞—Ç—å—é –∏ –≤–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ ---
            function beforePrint(){
                if (__IS_MOBILE){
                    clearAll();
                    paginateFromData(__CV_DATA); // –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã A4
                }
            }
            function afterPrint(){
                if (__IS_MOBILE){
                    clearAll();
                    renderMobile(__CV_DATA);     // –≤–µ—Ä–Ω—É—Ç—å –º–æ–±–∏–ª—å–Ω—É—é –ª–µ–Ω—Ç—É
                }
            }
            window.addEventListener('beforeprint', beforePrint);
            window.addEventListener('afterprint',  afterPrint);

            const mqPrint = window.matchMedia('print');
            if (mqPrint && mqPrint.addEventListener){
                mqPrint.addEventListener('change', e => e.matches ? beforePrint() : afterPrint());
            } else if (mqPrint && mqPrint.addListener){ // —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ API
                mqPrint.addListener(e => e.matches ? beforePrint() : afterPrint());
            }
        }catch(e){
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å data.json', e);
        }
    }

    /* === –£—Ç–∏–ª–∏—Ç—ã === */
    function el(tag, attrs={}, children=[]){
        const node = document.createElement(tag);
        Object.entries(attrs).forEach(([k,v])=>{
            if(k==='text') node.textContent = v;
            else if(k==='html') node.innerHTML = v;
            else if(k==='class') node.className = v;
            else node.setAttribute(k,v);
        });
        children.forEach(ch => node.appendChild(ch));
        return node;
    }
    function clearAll(){
        const p = document.getElementById('pages');
        const m = document.getElementById('mobile');
        p.innerHTML = '';
        m.innerHTML = '';
    }

    /* === –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∏–∑ JSON (–æ–±—â–∏–µ –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤) === */
    function buildLeftBlocks(cv){
        const out = [];
        if (cv.personal?.photo){
            const ph = el('div', {class:'blk block-photo'}, [ el('img', {src: cv.personal.photo, alt:'–§–æ—Ç–æ'}) ]);
            out.push(ph);
        }
        const contacts = el('div', {class:'blk block-contacts'}, [ el('h2', {text:'–ö–æ–Ω—Ç–∞–∫—Ç—ã'}), el('ul', {}, []) ]);
        const cul = contacts.querySelector('ul');
        if (cv.contacts?.email) cul.appendChild(el('li', {html:`üìß <a href="mailto:${cv.contacts.email}">${cv.contacts.email}</a>`}));
        if (cv.contacts?.phone){
            const telDigits = cv.contacts.phone.replace(/\s|-/g,'');
            cul.appendChild(el('li', {html:`üì± <a href="tel:${telDigits}">${cv.contacts.phone}</a>`}));
        }
        if (cv.contacts?.location) cul.appendChild(el('li', {text:`üìç ${cv.contacts.location}`}));
        if (cv.contacts?.telegram){
            const txt = cv.contacts.telegram.replace(/^https?:\/\//,'');
            cul.appendChild(el('li', {html:`üí¨ <a href="${cv.contacts.telegram}" target="_blank">${txt}</a>`}));
        }
        out.push(contacts);

        if (Array.isArray(cv.skills) && cv.skills.length){
            out.push(el('div', {class:'blk block-skills'}, [
                el('h2', {text:'–ù–∞–≤—ã–∫–∏'}),
                el('ul', {class:'pillset'}, cv.skills.map(x=>el('li',{text:x})))
            ]));
        }
        if (Array.isArray(cv.tools) && cv.tools.length){
            out.push(el('div', {class:'blk block-tools'}, [
                el('h2', {text:'–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã'}),
                el('ul', {class:'pillset'}, cv.tools.map(x=>el('li',{text:x})))
            ]));
        }
        return out;
    }
    function buildRightBlocks(cv){
        const seq = [];
        const head = el('div', {class:'blk'}, [
            el('div', {class:'block-name'}, [ el('h1', {text: cv.personal?.name || ''}) ]),
            el('div', {class:'block-position', text: cv.personal?.position || ''})
        ]);
        seq.push(head);

        if (cv.personal?.about){
            seq.push(el('div', {class:'blk block-about-me'}, [
                el('h2', {text:'–û–±–æ –º–Ω–µ'}),
                el('p', {text: cv.personal.about})
            ]));
        }

        const expHeader = () => el('div', {class:'blk'}, [ el('h2', {text:'–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã'}) ]);
        if (Array.isArray(cv.experience) && cv.experience.length){
            seq.push(expHeader());
            cv.experience.forEach(job=>{
                const jobDiv = el('div', {class:'blk block-experience'}, [
                    el('div', {class:'job'}, [
                        el('h3', {text:`${job.company} ‚Äî ${job.position}`}),
                        el('div', {class:'meta', text:`${job.period}${job.location ? ', ' + job.location : ''}`}),
                        (Array.isArray(job.responsibilities) && job.responsibilities.length)
                            ? el('ul', {}, job.responsibilities.map(r=>el('li',{text:r})))
                            : el('div')
                    ])
                ]);
                jobDiv.dataset.section = 'experience';
                seq.push(jobDiv);
            });
        }

        const eduHeader = () => el('div', {class:'blk'}, [ el('h2', {text:'–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ'}) ]);
        if (Array.isArray(cv.education) && cv.education.length){
            seq.push(eduHeader());
            cv.education.forEach(ed=>{
                const edBlk = el('div', {class:'blk block-education'}, [
                    el('p', {}, [
                        el('strong', {text: ed.institution || ''}),
                        el('br'),
                        el('span', {class:'meta', text:`${ed.period || ''} ¬∑ ${ed.program || ''}`})
                    ])
                ]);
                edBlk.dataset.section = 'education';
                seq.push(edBlk);
            });
        }
        return { seq };
    }

    /* === Desktop: –∞–≤—Ç–æ–ø–∞–≥–∏–Ω–∞—Ü–∏—è A4 === */
    function newPage(){
        const tmpl = document.getElementById('page-template');
        return tmpl.content.firstElementChild.cloneNode(true);
    }
    function pageFits(page){ return page.scrollHeight <= page.clientHeight + 0.5; }
    function appendWithPagination(pagesWrap, page, columnEl, block){
        columnEl.appendChild(block);
        if (!pageFits(page)){
            columnEl.removeChild(block);
            const next = newPage();
            pagesWrap.appendChild(next);
            const left = next.querySelector('.colum-left');
            const right = next.querySelector('.colum-right');
            (columnEl.classList.contains('colum-left') ? left : right).appendChild(block);
            return next;
        }
        return page;
    }
    function paginateFromData(cv){
        const pagesWrap = document.getElementById('pages');
        pagesWrap.innerHTML='';
        let page = newPage(); pagesWrap.appendChild(page);
        let left = page.querySelector('.colum-left');
        let right = page.querySelector('.colum-right');

        buildLeftBlocks(cv).forEach(block=>{
            const before = page;
            page = appendWithPagination(pagesWrap, page, left, block);
            if (page !== before){ left = page.querySelector('.colum-left'); right = page.querySelector('.colum-right'); }
        });

        const { seq } = buildRightBlocks(cv);
        seq.forEach(block=>{
            const before = page;
            page = appendWithPagination(pagesWrap, page, right, block);
            if (page !== before){ left = page.querySelector('.colum-left'); right = page.querySelector('.colum-right'); }
        });
    }

    /* === Mobile: –æ–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞-–ª–µ–Ω—Ç–∞ === */
    function renderMobile(cv){
        const wrap = document.getElementById('mobile');
        wrap.innerHTML = '';

        const left = buildLeftBlocks(cv);
        const rightSeq = buildRightBlocks(cv).seq;

        // –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑:
        const order = [...left, ...rightSeq];
        order.forEach(b => wrap.appendChild(b));
    }
</script>
</body>
</html>
